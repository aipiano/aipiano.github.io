---
layout:     post
title:        SLAM算法评估中的轨迹拟合与外参求解
subtitle:   Trajectory Alignment, Transform Optimization
date:       2019-01-08
author:     Jerry Zhao
header-img: img/post-bg-walle.jpg
catalog: true
tags:
    - SLAM
    - Robotics
    - Algorithms
---


## 问题描述
SLAM中常常碰到对齐（align）两个不同设备采集的轨迹的问题。比如通过VICON跟踪获得了一组轨迹，手机通过SLAM算法也获得一组轨迹，要评估SLAM算法的精度，就需要将手机获得的轨迹与作为真值的VICON轨迹对齐。


## 数学关系
设`\(_{lp}^{gp}T\)`代表手机（phone）从当前局部坐标系（local）到SLAM算法定义的世界坐标系（global）的变换，即当前手机在SLAM算法定义的世界坐标系下的位姿。

设`\(_{lv}^{gv}T\)`代表从VICON的当前刚体坐标系到VICON定义的世界坐标系的变换，即VICON跟踪的刚体在VICON世界坐标系下的位姿。


这几个变换满足：
`\[
_{gp}^{gv}T\ *\ _{lp}^{gp}T\ =\ _{lv}^{gv}T\ *\ _{lp}^{lv}T
\]`

其中`\(_{lp}^{gp}T\)`和`\(_{lv}^{gv}T\)`均是已知量，多个`\(_{lp}^{gp}T\)`和`\(_{lv}^{gv}T\)`各自构成了两条运动轨迹，轨迹中的每一帧记为`\(_{lp}^{gp}T_i\)`和`\(_{lv}^{gv}T_j\)`。`\(_{gp}^{gv}T\)`和`\(_{lp}^{lv}T\)`是待求解的未知量。如果手机与VICON刚体是刚性连接的，在整个运动过程中，`\(_{gp}^{gv}T\)`和`\(_{lp}^{lv}T\)`的值是定值。


## 求解方法
优化的目标函数为：
`\[
\min_{_{gp}^{gv}T,\ _{lp}^{lv}T} \sum_{i}\Vert\ _{gp}^{gv}T\ *\ _{lp}^{gp}T_i\ -\ _{lv}^{gv}T_{j(i)}\ *\ _{lp}^{lv}T\ \Vert_F^2
\]`
其中`\(_{lv}^{gv}T_{j(i)}\)`表示在时间戳上与`\(_{lp}^{gp}T_i\)`对应的某一帧。

上式不好直接优化，原因在于
1. 自由度过大，如果旋转用四元数表示，上式要同时优化12个自由量。
2. 约束不足，存在奇异解，比如`\(_{gp}^{gv}T\)`和`\(_{lp}^{lv}T\)`均为零，显然是上式的一个极小解。

因此考虑分部优化。

### 求解`\(_{gp}^{gv}T\)`

## 参考文献
1. [Least-Squares Rigid Motion Using SVD](https://igl.ethz.ch/projects/ARAP/svd_rot.pdf)
2. [Quaternion Averaging](https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/20070017872.pdf)
3. [Unified Temporal and Spatial Calibration for Multi-Sensor Systems](https://furgalep.github.io/bib/furgale_iros13.pdf)